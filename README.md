# Volume Renderer - å®æ—¶ä½“æ¸²æŸ“é¡¹ç›®

åŸºäºRay Marchingç®—æ³•çš„å®æ—¶ä½“æ¸²æŸ“æ¡†æ¶ï¼Œç”¨äºå›¾å½¢å­¦å¤§ä½œä¸šã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å®æ—¶ä½“æ¸²æŸ“ç³»ç»Ÿï¼Œæ”¯æŒäº‘ã€çƒŸé›¾ç­‰åŠé€æ˜å‚ä¸ä»‹è´¨çš„æ¸²æŸ“ã€‚é‡‡ç”¨Ray Marchingç®—æ³•ï¼Œæ”¯æŒå¤šç§å®æ—¶ä¼˜åŒ–æŠ€æœ¯ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **Ray Marchingæ ¸å¿ƒç®—æ³•** - æ²¿å…‰çº¿æ­¥è¿›é‡‡æ ·ä½“ç§¯æ•°æ®
- âœ… **å®æ—¶æ¸²æŸ“** - åŸºäºOpenGLçš„é«˜æ€§èƒ½æ¸²æŸ“ç®¡çº¿
- âœ… **æŠ–åŠ¨é‡‡æ ·ä¼˜åŒ–** - å‡å°‘æ¡å¸¦ä¼ªå½±
- âœ… **ä¼ è¾“å‡½æ•°** - å¯è‡ªå®šä¹‰çš„é¢œè‰²æ˜ å°„
- âœ… **å…‰ç…§è®¡ç®—** - åŸºäºæ¢¯åº¦çš„æ³•çº¿è®¡ç®—å’ŒPhongå…‰ç…§æ¨¡å‹
- âœ… **äº¤äº’å¼æ‘„åƒæœº** - æ”¯æŒè‡ªç”±ç§»åŠ¨å’Œæ—‹è½¬
- âœ… **ImGuiå‚æ•°è°ƒèŠ‚** - å®æ—¶è°ƒæ•´æ¸²æŸ“å‚æ•°

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: C++17
- **å›¾å½¢API**: OpenGL 3.3+
- **ä¾èµ–åº“**:
  - GLFW - çª—å£å’Œè¾“å…¥ç®¡ç†
  - GLAD - OpenGLå‡½æ•°åŠ è½½
  - GLM - æ•°å­¦åº“
  - ImGui - ç”¨æˆ·ç•Œé¢

## é¡¹ç›®ç»“æ„

```
CG_work/
â”œâ”€â”€ include/           # å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ Types.h        # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ Shader.h       # Shaderç®¡ç†ç±»
â”‚   â”œâ”€â”€ Camera.h       # æ‘„åƒæœºæ§åˆ¶
â”‚   â”œâ”€â”€ VolumeData.h   # ä½“æ•°æ®ç®¡ç†
â”‚   â””â”€â”€ Renderer.h     # æ¸²æŸ“å™¨ï¼ˆAPIæ¥å£å®ç°ï¼‰
â”œâ”€â”€ src/               # æºæ–‡ä»¶
â”‚   â”œâ”€â”€ main.cpp       # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ Shader.cpp
â”‚   â”œâ”€â”€ Camera.cpp
â”‚   â”œâ”€â”€ VolumeData.cpp
â”‚   â””â”€â”€ Renderer.cpp
â”œâ”€â”€ shaders/           # GLSLç€è‰²å™¨
â”‚   â”œâ”€â”€ raymarching.vert
â”‚   â””â”€â”€ raymarching.frag
â”œâ”€â”€ data/              # ä½“æ•°æ®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ external/          # ç¬¬ä¸‰æ–¹åº“ï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰
â”‚   â”œâ”€â”€ glfw/
â”‚   â”œâ”€â”€ glad/
â”‚   â”œâ”€â”€ glm/
â”‚   â””â”€â”€ imgui/
â”œâ”€â”€ CMakeLists.txt     # CMakeæ„å»ºé…ç½®
â””â”€â”€ APIå¯¹æ¥.md         # APIæ¥å£æ–‡æ¡£
```

## ç¼–è¯‘ä¸è¿è¡Œ

### å‰ç½®è¦æ±‚

1. **CMake** (>= 3.15)
2. **C++17ç¼–è¯‘å™¨** (MSVC 2019+, GCC 7+, Clang 5+)
3. **OpenGL 3.3+æ”¯æŒ**

### ä¾èµ–åº“å®‰è£…

åœ¨ç¼–è¯‘å‰éœ€è¦å°†ä»¥ä¸‹åº“æ”¾å…¥ `external/` ç›®å½•ï¼š

1. **GLFW** - https://www.glfw.org/
2. **GLAD** - https://glad.dav1d.de/ (OpenGL 3.3, Core Profile)
3. **GLM** - https://github.com/g-truc/glm
4. **ImGui** - https://github.com/ocornut/imgui

### æ„å»ºæ­¥éª¤

#### Windows (Visual Studio)

```powershell
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

# ç”ŸæˆVisual Studioé¡¹ç›®
cmake ..

# ç¼–è¯‘ï¼ˆæˆ–è€…ç›´æ¥æ‰“å¼€.slnæ–‡ä»¶ç”¨VSç¼–è¯‘ï¼‰
cmake --build . --config Release

# è¿è¡Œ
.\bin\Release\VolumeRenderer.exe
```

#### Linux

```bash
mkdir build && cd build
cmake ..
make -j4
./bin/VolumeRenderer
```

## ä½¿ç”¨è¯´æ˜

### æ§åˆ¶æ–¹å¼

- **W/A/S/D** - å‰åå·¦å³ç§»åŠ¨æ‘„åƒæœº
- **Space/Ctrl** - å‘ä¸Š/å‘ä¸‹ç§»åŠ¨
- **é¼ æ ‡å³é”®æ‹–æ‹½** - æ—‹è½¬è§†è§’
- **é¼ æ ‡æ»šè½®** - ç¼©æ”¾ï¼ˆè°ƒæ•´FOVï¼‰
- **ESC** - é€€å‡ºç¨‹åº

### å‚æ•°è°ƒèŠ‚

ç¨‹åºè¿è¡Œæ—¶ä¼šæ˜¾ç¤ºImGuiæ§åˆ¶é¢æ¿ï¼Œå¯ä»¥å®æ—¶è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

#### Ray Marchingå‚æ•°
- **Step Size** - æ­¥è¿›å¤§å°ï¼ˆè¶Šå°è¶Šç²¾ç»†ä½†è¶Šæ…¢ï¼‰
- **Density** - å¯†åº¦ç³»æ•°ï¼ˆæ§åˆ¶äº‘é›¾æµ“åº¦ï¼‰
- **Threshold** - é˜ˆå€¼ï¼ˆè¿‡æ»¤ä½å¯†åº¦åŒºåŸŸï¼‰
- **Max Steps** - æœ€å¤§æ­¥è¿›æ¬¡æ•°

#### å…‰ç…§å‚æ•°
- **Enable Lighting** - å¯ç”¨/ç¦ç”¨å…‰ç…§
- **Absorption** - å¸æ”¶ç³»æ•°
- **Scattering** - æ•£å°„ç³»æ•°
- **Light Direction** - å…‰æºæ–¹å‘

#### ä¼˜åŒ–é€‰é¡¹
- **Enable Jittering** - æŠ–åŠ¨é‡‡æ ·ï¼ˆå‡å°‘æ¡å¸¦ä¼ªå½±ï¼‰

## APIæ¥å£è¯´æ˜

æœ¬é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§ `APIå¯¹æ¥.md` ä¸­å®šä¹‰çš„æ¥å£å®ç°ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

### æ ¸å¿ƒæ¥å£ï¼ˆRendererç±»ï¼‰

```cpp
// åˆå§‹åŒ–æ¸²æŸ“å™¨
bool InitRenderer(int width, int height);

// æ¸²æŸ“ä¸€å¸§
void RenderFrame();

// æ›´æ–°æ¸²æŸ“å‚æ•°
void SetRenderParams(const RenderParams& params);

// æ›´æ–°æ‘„åƒæœº
void SetCamera(const Camera& camera);

// æ›´æ–°ä¼ è¾“å‡½æ•°
void SetTransferFunction(const std::vector<glm::vec4>& colors);

// çª—å£å¤§å°å˜åŒ–
void Resize(int width, int height);

// è·å–æ€§èƒ½ç»Ÿè®¡
RenderStats GetRenderStats() const;
```

è¯¦ç»†çš„APIè¯´æ˜è¯·å‚è€ƒ `APIå¯¹æ¥.md`ã€‚

## ç®—æ³•å®ç°

### Ray Marchingæ ¸å¿ƒæµç¨‹

1. **å…‰çº¿ç”Ÿæˆ** - ä»æ‘„åƒæœºä½ç½®å’Œæ–¹å‘ç”Ÿæˆå±å¹•åƒç´ å¯¹åº”çš„å…‰çº¿
2. **AABBæ±‚äº¤** - è®¡ç®—å…‰çº¿ä¸ä½“ç§¯åŒ…å›´ç›’çš„äº¤ç‚¹
3. **ä½“ç§¯é‡‡æ ·** - æ²¿å…‰çº¿æ­¥è¿›ï¼Œåœ¨æ¯ä¸ªé‡‡æ ·ç‚¹è¯»å–ä½“æ•°æ®
4. **ä¼ è¾“å‡½æ•°æ˜ å°„** - å°†å¯†åº¦å€¼æ˜ å°„åˆ°é¢œè‰²å’Œé€æ˜åº¦
5. **å…‰ç…§è®¡ç®—** - åŸºäºæ¢¯åº¦è®¡ç®—æ³•çº¿ï¼Œåº”ç”¨Phongå…‰ç…§æ¨¡å‹
6. **é¢œè‰²ç´¯ç§¯** - Front-to-backåˆæˆï¼Œç´¯ç§¯æœ€ç»ˆé¢œè‰²

### ä¼˜åŒ–æŠ€æœ¯

- **æŠ–åŠ¨é‡‡æ ·ï¼ˆJittered Samplingï¼‰** - éšæœºåç§»èµ·å§‹ç‚¹ï¼Œå‡å°‘æ¡å¸¦ä¼ªå½±
- **æ—©æœŸç»ˆæ­¢** - å½“ç´¯ç§¯é€æ˜åº¦æ¥è¿‘ä¸é€æ˜æ—¶æå‰ç»“æŸ
- **AABBå‰”é™¤** - åªæ¸²æŸ“ä¸åŒ…å›´ç›’ç›¸äº¤çš„å…‰çº¿

## æ‰©å±•æ–¹å‘

é¡¹ç›®æ¡†æ¶å·²é¢„ç•™æ¥å£ï¼Œå¯ä»¥è¿›ä¸€æ­¥å®ç°ï¼š

1. **å¤šé‡æ•£å°„è¿‘ä¼¼** - æå‡äº‘é›¾çš„çœŸå®æ„Ÿ
2. **è‡ªé€‚åº”æ­¥é•¿** - æ ¹æ®å¯†åº¦å˜åŒ–åŠ¨æ€è°ƒæ•´æ­¥é•¿
3. **ä½“æ•°æ®é¢„å¤„ç†** - å®ç°Mipmapæˆ–OctreeåŠ é€Ÿç»“æ„
4. **æ›´å¤æ‚çš„ä¼ è¾“å‡½æ•°** - å¤šç»´ä¼ è¾“å‡½æ•°ç¼–è¾‘å™¨
5. **çœŸå®ä½“æ•°æ®åŠ è½½** - æ”¯æŒ.raw, .volç­‰æ ¼å¼

## æ³¨æ„äº‹é¡¹

- å½“å‰ç‰ˆæœ¬ä½¿ç”¨ç¨‹åºåŒ–ç”Ÿæˆçš„æµ‹è¯•æ•°æ®ï¼ˆçƒå½¢äº‘é›¾ï¼‰
- å¦‚éœ€åŠ è½½çœŸå®ä½“æ•°æ®ï¼Œè¯·ä¿®æ”¹ `VolumeData::LoadFromFile` æ–¹æ³•
- æ€§èƒ½å— `stepSize` å’Œ `maxSteps` å½±å“è¾ƒå¤§ï¼Œå»ºè®®åœ¨è´¨é‡å’Œæ€§èƒ½é—´å¹³è¡¡

## å‚è€ƒèµ„æ–™

- [Perlin Hypertexture](https://ohiostate.pressbooks.pub/app/uploads/sites/45/2017/09/perlin-hypertexture.pdf)
- [Real-Time Volume Graphics](http://www.real-time-volume-graphics.org/)
- OpenGL Programming Guide
- GPU Gems - Volume Rendering Techniques

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºæ•™å­¦å’Œå­¦ä¹ ç›®çš„ã€‚

## ä½œè€…

å›¾å½¢å­¦å¤§ä½œä¸š - ä½“æ¸²æŸ“å°ç»„

---

**ç¥ä½ å®ç°å‡ºç²¾å½©çš„ä½“æ¸²æŸ“æ•ˆæœï¼** ğŸŒ¥ï¸âœ¨